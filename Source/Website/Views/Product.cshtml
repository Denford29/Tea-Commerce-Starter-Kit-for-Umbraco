@using TeaCommerce.Api.Models
@using TeaCommerce.Umbraco.Web
@inherits UmbracoTemplatePage
@{
  Layout = "Master.cshtml";

  IPublishedContent currentPage = Model.Content;

  //store id
  long storeId = long.Parse( currentPage.GetPropertyValue<string>( "store", true ) );

  //Variants
  List<IPublishedContent> variants = currentPage.Children.ToList();
  bool hasVariants = variants.Any();

  //Main product data
  IPublishedContent mainProduct = currentPage.AncestorOrSelf( "Product" );
  int mainProductId = mainProduct.Id;
  var mainProductName = mainProduct.GetPropertyValue<string>( "name" );
  Price mainProductPrice = TC.GetPrice( storeId, mainProductId.ToString() );
  var mainProductDescription = new HtmlString( mainProduct.GetPropertyValue<string>( "description" ) );

  IPublishedContent mainProductImage = null;

  var mainProductimageId = mainProduct.GetPropertyValue<int>( "image" );
  if ( mainProductimageId != 0 ) {
    mainProductImage = Umbraco.TypedMedia( mainProductimageId );
  }
}
<div class="container">
  <div class="row">
    <div class="col-xs-12 col-sm-8">
      <div class="productImages">
        @if ( hasVariants ) {
          int variantCounter = 0;

          foreach ( IPublishedContent variant in variants ) {
            var imageId = variant.GetPropertyValue<int>( "image" );
            IPublishedContent image = imageId != 0 ? Umbraco.TypedMedia( imageId ) : mainProductImage;

            if ( image != null ) {
              <img data-variantid="@variant.Id" class="img-responsive @(variantCounter == 0 ? "" : "hidden")" src="@image.Url?width=750"/>
            }

            variantCounter++;
          }
        } else {
          if ( mainProductImage != null ) {
            <img class="img-responsive" src="@mainProductImage.Url?width=750"/>
          }
        }
      </div>
    </div>

    <div class="col-xs-12 col-sm-4 product">

      <form method="post" action="/base/TC/FormPost.aspx" class="ajaxForm">
        <input name="AddOrUpdateOrderLine" value="productIdentifier, quantity" type="hidden" />
        <input name="storeId" value="@storeId" type="hidden" />

        <div class="well">
          @if ( hasVariants ) {
            int variantCounter = 0;

            foreach ( IPublishedContent variant in variants ) {
              int id = variant.Id;
              var name = variant.GetPropertyValue<string>( "name", true );
              Price price = TC.GetPrice( storeId, id.ToString() );
              var description = variant.GetPropertyValue<HtmlString>( "description", true );

              <div data-variantid="@id" class="@(variantCounter == 0 ? "" : "hidden")">
                <h1 class="page-header">@name</h1>
                <p class="h3">@price</p>

                @if ( !string.IsNullOrEmpty( description.ToString() ) ) {
                  <div class="alert alert-info">
                    @Html.Raw( description )
                  </div>
                }
              </div>

              variantCounter++;
            }
            <p>
              <label for="variants">Variant:</label>
              <select class="form-control" name="productIdentifier" id="variants">
                @foreach ( IPublishedContent variant in variants ) {
                  <option value="@variant.Id" >@variant.Name</option>
                }
              </select>
            </p>
          } else {
            <h1 class="page-header">@mainProductName</h1>
            <span class="price">@mainProductPrice</span>
            @Html.Raw( mainProductDescription )
            <input name="productIdentifier" value="@mainProductId" type="hidden" />
          }
          <p>
            <label for="quantity">Quantity:</label>
            <input class="form-control" id="quantity" name="quantity" value="1" type="text" />
          </p>
          <input class="btn btn-primary btn-block" value="Add to basket" type="submit" />
        </div>
      </form>
    </div>
  </div>
</div>